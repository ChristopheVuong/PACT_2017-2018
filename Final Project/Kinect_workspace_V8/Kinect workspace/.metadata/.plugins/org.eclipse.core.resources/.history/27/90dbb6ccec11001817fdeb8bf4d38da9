package readAndWrite;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.Timer;

import utils.kinect.KinectReadInterface;
import utils.kinect.ShowSkeletonAbstract;
import utils.kinect.ShowSkeletonInterface;
import utils.listeners.EventListenerAbstract;
import viewer.Viewer3D;

/**
 * Initialise l'affichage du squelette et le maintient à jour à l'aide des nouvelles données de positions.
 */
public final class ShowSkeletonRead extends ShowSkeletonAbstract {

	private final KinectReadInterface kinectReadInterface;

	/**
	 * Lance une toile OpenGL.
	 * <p>
	 * Ajoute les listeners pour dessiner sur la toile, et pour pouvoir faire pivoter le squelette.
	 */
	public ShowSkeletonRead(final KinectReadInterface kinectReadInterface) {
		super(kinectReadInterface);

		this.kinectReadInterface = kinectReadInterface;

		getViewer().addEventListener(new EventListener(getViewer(), this));

		kinectReadInterface.getKinectFrameInterface().getPanel().add(getViewer(), "cell 0 4, span 4, align 50% 50%, gaptop 100");
		kinectReadInterface.getKinectFrameInterface().getPanel().add(getScrollbar(), "cell 0 5, span 4, align 50% 50%");
		
		getViewer().setVisible(false);
		getScrollbar().setVisible(false);
	}

	private final class EventListener extends EventListenerAbstract {

		public EventListener(final Viewer3D viewer, final ShowSkeletonInterface showSkeletonInterface) {
			super(ShowSkeletonRead.this.getViewer());
			TimerListener timerListener = new TimerListener(this, showSkeletonInterface);
			Timer timer = new Timer(50,timerListener);
			timerListener.setTimer(timer);
		}

		/**
		 * Permet d'afficher le contenu de la toile, qui grâce à l'Animator varie dynamiquement avec les variations du tableau positions.
		 */
		public void display() {
			if(kinectReadInterface.getShowing()) {
				kinectReadInterface.setPositions(kinectReadInterface.getPositionsOpen().get(kinectReadInterface.getCounter()).getPositions());
				displayConstruct(ShowSkeletonRead.this);

				if(kinectReadInterface.getCounterCurrent() != kinectReadInterface.getCounter()) {
					kinectReadInterface.setCounterCurrent(kinectReadInterface.getCounter());
					kinectReadInterface.getTimer().start();
				}
			}
		}
	}
}